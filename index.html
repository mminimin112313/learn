<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>통합 학습 환경 (ILE) v8.5 - Full Version</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Tailwind CSS CDN 추가 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    // 디자인 시스템 매뉴얼에 따른 색상 팔레트 정의
                    colors: {
                        'primary-blue': {
                            'darkest': '#082567', // Twilight Gem
                            'dark': '#1A3B70',   // Abyss Ink (추정치)
                            'middle': '#4285F4', // Still Current
                            'light': '#357AE8',  // Blue Pulse
                            'lightest': '#EBF2FA', // Sky Surge
                        },
                        'secondary-gray': {
                            '100': '#F8F9FA', // Snow Flake / input-bg
                            '200': '#F0F3F7', // current bg-secondary
                            '300': '#DADCE0', // current border-color
                            '500': '#80868B', // current text-placeholder
                            '600': '#5F6368', // current text-secondary
                            '800': '#3C4043', // current text-primary
                        },
                        'secondary-teal': '#00A389', // Teal 계열
                        'accent-orange': '#FF6B00', // Vibrant Orange
                        'semantic-success': '#28A745', // Emerald Green
                        'semantic-error': '#DC3545',   // Crimson Red
                        'semantic-warning': '#FFC107', // Golden Yellow
                        'semantic-info': '#17A2B8',    // Light Blue
                        'bg-warm-offwhite': '#F1EDE8', // Worn Dune
                        'bg-cool-offwhite': '#E9EDF2', // Cloud Slate
                    },
                    // 폰트 스케일 및 줄 간격 (Tailwind 기본값 사용을 권장하지만, 필요시 확장)
                    fontSize: {
                        'xs': '.75rem',  // 12px
                        'sm': '.875rem', // 14px
                        'base': '1rem',  // 16px (본문 기준)
                        'lg': '1.125rem', // 18px
                        'xl': '1.25rem', // 20px
                        '2xl': '1.5rem', // 24px (H4)
                        '3xl': '1.875rem', // 30px
                        '4xl': '2.25rem', // 36px (H2)
                        '5xl': '3rem',   // 48px (H1)
                    },
                    lineHeight: {
                        'normal': '1.5', // 텍스트 크기의 1.5배
                        'relaxed': '1.6', // 텍스트 크기의 1.6배 (최적 가독성)
                    },
                }
            }
        }
    </script>
    
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    
    <style>
        /* CSS 변수를 Tailwind 색상 시스템에 맞춰 재정의 (Fallback 및 초기 스타일용) */
        :root {
            --bg-primary: var(--tw-colors-secondary-gray-100); /* Snow Flake */
            --bg-secondary: var(--tw-colors-secondary-gray-200); /* 기존 bg-secondary */
            --card-background: var(--tw-colors-secondary-gray-100); /* Snow Flake */
            --accent-primary: var(--tw-colors-primary-blue-middle); /* Still Current */
            --accent-rgb: 66, 133, 244; 
            --accent-primary-hover: var(--tw-colors-primary-blue-light); 
            --accent-primary-focus-ring: rgba(var(--accent-rgb), 0.3);
            --text-primary: var(--tw-colors-secondary-gray-800); /* Dark Gray */
            --text-secondary: var(--tw-colors-secondary-gray-600); /* Medium Gray */
            --text-placeholder: var(--tw-colors-secondary-gray-500); /* Lighter Gray */
            --border-color: var(--tw-colors-secondary-gray-300); /* Light Gray */
            --input-bg: var(--tw-colors-secondary-gray-100); /* Very light gray */
            --success-color: var(--tw-colors-semantic-success); 
            --warning-color: var(--tw-colors-semantic-warning);
            --danger-color: var(--tw-colors-semantic-error); 
            --info-color: var(--tw-colors-semantic-info); /* New: Info color for toasts */
            --font-sans: 'Inter', 'Noto Sans KR', sans-serif;
            --font-mono: 'SFMono-Regular', Consolas, Menlo, monospace;
            --sidebar-width: 300px;
        }
        html, body { height: 100%; overflow: hidden; }
        body { 
            background-color: var(--bg-primary); 
            color: var(--text-primary); 
            font-family: var(--font-sans); 
            font-size: 1rem; /* Base body font size 16px */
            line-height: var(--tw-line-height-relaxed); /* 최적 가독성 1.6배 */
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }
        
        .ile-container { 
            @apply flex flex-col h-full md:grid md:grid-cols-[var(--sidebar-width)_1fr]; 
        }
        .sidebar { 
            @apply fixed top-0 left-0 w-[var(--sidebar-width)] h-full bg-secondary-gray-200 border-r border-secondary-gray-300 flex flex-col gap-6 p-4 transform -translate-x-full transition-transform duration-300 ease-in-out z-[1100] overflow-y-auto; 
            /* Tailwind의 z-index보다 높게 설정 */
        }
        .sidebar.is-open { 
            @apply translate-x-0 shadow-2xl; /* Lighter shadow for light theme */
        }
        .main-content { 
            @apply overflow-y-auto flex-grow flex flex-col md:h-screen; 
        }
        .main-content-inner { 
            @apply p-4 md:p-8; /* 모바일/데스크탑 패딩 조정 */
        }
        .mobile-header { 
            @apply flex items-center justify-between py-3 px-6 bg-secondary-gray-200 border-b border-secondary-gray-300 sticky top-0 z-[1000] text-secondary-gray-800 md:hidden;
        }
        .mobile-header .hamburger-btn { 
            @apply bg-transparent border-none text-secondary-gray-800 text-2xl p-2 leading-none; 
        }
        .mobile-header .project-title-mobile { 
            @apply text-xl font-semibold whitespace-nowrap overflow-hidden text-ellipsis; 
        }
        .overlay { 
            @apply fixed inset-0 bg-black bg-opacity-40 opacity-0 invisible transition-opacity duration-300 ease-in-out z-[1099]; 
        }
        .overlay.is-visible { 
            @apply opacity-100 visible; 
        }
        .sidebar-header h4 { 
            @apply text-xl font-semibold text-secondary-gray-800; 
        }
        .sidebar-title { 
            @apply text-base font-semibold mb-3 text-secondary-gray-800; 
        }
        
        /* Project List Specific Styles */
        .sidebar-section.project-list-section .list-group {
            @apply max-h-[250px] overflow-y-auto border border-secondary-gray-300 rounded-lg;
        }

        .list-group-item { 
            @apply bg-secondary-gray-200 border border-secondary-gray-300 text-secondary-gray-600 cursor-pointer transition-all duration-200 break-all py-2.5 px-4 flex justify-between items-center; 
        }
        .list-group-item:hover { 
            @apply bg-secondary-gray-100 text-secondary-gray-800; 
        }
        .list-group-item.active { 
            @apply bg-primary-blue-middle text-white border-primary-blue-middle; 
        }
        .list-group-item .delete-btn { 
            @apply opacity-0 transition-opacity duration-200 text-secondary-gray-600; 
        } 
        .list-group-item:hover .delete-btn { 
            @apply opacity-100; 
        }
        .main-header h1 { 
            @apply font-bold text-4xl md:text-5xl text-secondary-gray-800; /* H1: 48px */
        }
        .main-header p { 
            @apply text-secondary-gray-600; 
        }

        /* Responsive Module Grid - Tailwind classes will handle this more fluidly */
        .module-grid { 
            @apply grid grid-cols-1 gap-6 
                    sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4; /* 300px minmax 대신 Tailwind의 반응형 그리드 사용 */
        }

        .module-card { 
            @apply bg-secondary-gray-100 border-l-4 border-secondary-gray-300 p-5 rounded-lg transition-all duration-200 border; 
        }
        .module-card:hover { 
            @apply transform -translate-y-1 shadow-lg; /* Lighter shadow for light theme */
        }
        .module-card.status-pending { 
            @apply border-l-secondary-gray-600; 
        } 
        .module-card.status-inprogress { 
            @apply border-l-semantic-warning; 
        }
        .module-card.status-completed { 
            @apply border-l-semantic-success; 
        }
        .modal-content { 
            @apply bg-secondary-gray-100 border border-secondary-gray-300 text-secondary-gray-800 rounded-lg; 
        }
        .modal-header { 
            @apply border-b border-secondary-gray-300; 
        }
        .modal-footer { 
            @apply border-t border-secondary-gray-300; 
        }
        .btn-close { 
            @apply text-secondary-gray-800 opacity-50 hover:opacity-75 focus:opacity-100 focus:outline-none focus:ring-4 focus:ring-primary-blue-middle/30;
        }

        .form-control, .form-select { 
            @apply bg-secondary-gray-100 text-secondary-gray-800 border-secondary-gray-300; 
        }
        .form-control::placeholder { 
            @apply text-secondary-gray-500; 
        } 
        .form-control:focus, .form-select:focus { 
            @apply border-primary-blue-middle ring-primary-blue-middle/30; 
        }
        
        /* Study Pad Textarea Height */
        .module-studypad, .module-notes {
            @apply min-h-[80px] resize-y;
        }

        #live-preview-container { 
            @apply bg-secondary-gray-100 rounded-lg p-4 font-mono text-sm whitespace-pre-wrap break-words border border-secondary-gray-300 min-h-[250px] max-h-[400px] overflow-y-auto text-secondary-gray-800; 
        }
        .toast { 
            @apply bg-secondary-gray-100 border-l-4 text-secondary-gray-800 rounded-md shadow-lg; /* Tailwind shadow */
        }
        .toast-header { 
            @apply border-b border-secondary-gray-300 text-secondary-gray-800; 
        }
        .action-category { 
            @apply border-l-4 border-primary-blue-middle pl-4 text-secondary-gray-800; 
        }
        .action-list-item { 
            @apply bg-secondary-gray-100 border border-secondary-gray-300 text-secondary-gray-800 p-3 rounded-md mb-2 flex justify-between items-center; 
        }

        /* Markdown Viewer styles */
        #study-pad-viewer-content {
            @apply bg-secondary-gray-100 p-6 rounded-lg border border-secondary-gray-300 min-h-[200px] max-h-[60vh] overflow-y-auto text-secondary-gray-800;
        }
        #study-pad-editor-content { 
            @apply min-h-[200px] max-h-[60vh] resize-y;
        }
        #study-pad-viewer-content h1 { @apply text-5xl font-bold text-primary-blue-darkest mt-6 mb-2; } /* H1: 48px */
        #study-pad-viewer-content h2 { @apply text-4xl font-semibold text-primary-blue-darkest mt-6 mb-2; } /* H2: 40px */
        #study-pad-viewer-content h3 { @apply text-3xl font-semibold text-primary-blue-darkest mt-6 mb-2; } /* H3: 32px */
        #study-pad-viewer-content h4 { @apply text-2xl font-semibold text-primary-blue-darkest mt-6 mb-2; } /* H4: 24px */
        #study-pad-viewer-content h5 { @apply text-xl font-semibold text-primary-blue-darkest mt-6 mb-2; } /* H5: 20px */
        #study-pad-viewer-content h6 { @apply text-base font-semibold text-primary-blue-darkest mt-6 mb-2; } /* H6: 16px */
        
        #study-pad-viewer-content p { @apply mb-4 leading-relaxed; } /* 1.6배 줄 간격 */
        #study-pad-viewer-content ul, #study-pad-viewer-content ol { @apply mb-4 pl-6; }
        #study-pad-viewer-content li { @apply mb-2; }
        #study-pad-viewer-content pre {
            @apply bg-secondary-gray-200 p-4 rounded-md overflow-x-auto border border-secondary-gray-300 whitespace-pre-wrap break-words;
        }
        #study-pad-viewer-content code {
            @apply font-mono bg-secondary-gray-200 px-1.5 py-1 rounded-sm;
        }
        #study-pad-viewer-content a {
            @apply text-primary-blue-middle no-underline hover:underline;
        }
        #study-pad-viewer-content blockquote {
            @apply border-l-4 border-primary-blue-middle pl-4 ml-0 text-secondary-gray-600;
        }
        #study-pad-viewer-content table {
            @apply w-full border-collapse mb-4;
        }
        #study-pad-viewer-content th, #study-pad-viewer-content td {
            @apply border border-secondary-gray-300 p-2 text-left;
        }
        #study-pad-viewer-content th {
            @apply bg-secondary-gray-200 font-semibold;
        }

        /* Button styles for light theme (Tailwind-compatible classes) */
        .btn-primary { 
            @apply bg-primary-blue-middle border-primary-blue-middle text-white hover:bg-primary-blue-light hover:border-primary-blue-light; 
        }
        .btn-outline-primary { 
            @apply text-primary-blue-middle border-primary-blue-middle bg-transparent hover:bg-primary-blue-middle hover:text-white; 
        }
        .btn-info { 
            @apply bg-semantic-info border-semantic-info text-white hover:opacity-90;
        }
        .btn-success { 
            @apply bg-semantic-success border-semantic-success text-white hover:opacity-90;
        }
        .btn-secondary {
            @apply bg-secondary-gray-600 border-secondary-gray-600 text-white hover:bg-secondary-gray-800 hover:border-secondary-gray-800;
        }
        .btn-outline-secondary {
            @apply text-secondary-gray-600 border-secondary-gray-300 bg-transparent hover:bg-secondary-gray-100 hover:text-secondary-gray-800;
        }
        .btn-outline-light { 
            @apply text-secondary-gray-800 border-secondary-gray-300 bg-transparent hover:bg-secondary-gray-100 hover:text-secondary-gray-800;
        }
        .btn-outline-danger {
            @apply text-semantic-error border-semantic-error bg-transparent hover:bg-semantic-error hover:text-white;
        }

        /* Modal specific adjustments for z-index and appearance */
        .modal-backdrop {
            z-index: 1201; /* Above toasts (1200) */
        }
        .modal {
            z-index: 1202; /* Above backdrop and toasts */
        }

        /* New styles for learning objectives/keywords */
        .module-card .learning-objectives-preview {
            @apply max-h-[4.5em] overflow-hidden text-ellipsis block; /* Approximately 3 lines of text */
            -webkit-line-clamp: 3; /* Limit to 3 lines */
            -webkit-box-orient: vertical;
            white-space: normal; /* Allow text to wrap */
            @apply mb-2 text-secondary-gray-600 text-sm;
            display: -webkit-box; /* Required for -webkit-line-clamp */
        }

        /* Modal for detailed view */
        .detail-modal-content pre {
            @apply bg-secondary-gray-200 p-4 rounded-md overflow-x-auto border border-secondary-gray-300 whitespace-pre-wrap break-words;
        }

        /* Empty State Styling */
        .empty-state {
            @apply text-center py-10 px-4 flex flex-col items-center justify-center;
        }
        .empty-state-icon {
            @apply text-6xl text-secondary-gray-300 mb-4;
        }
        .empty-state-title {
            @apply text-2xl font-semibold text-secondary-gray-800 mb-2;
        }
        .empty-state-message {
            @apply text-secondary-gray-600 mb-6 max-w-md;
        }
        .empty-state-cta {
            @apply mt-4;
        }
    </style>
</head>
<body>
    <div class="ile-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header"><h4><i class="fa-solid fa-brain me-2"></i>ILE v8.5</h4></div>
            
            <!-- Firebase Auth Section -->
            <div class="sidebar-section">
                <div id="auth-status" class="text-center text-sm mb-2 text-secondary-gray-600">로그인 필요</div>
                <button class="btn btn-primary btn-sm w-full mb-2" id="google-signin-btn"><i class="fa-brands fa-google me-2"></i>Google 로그인</button>
                <button class="btn btn-danger btn-sm w-full d-none" id="signout-btn"><i class="fa-solid fa-right-from-bracket me-2"></i>로그아웃</button>
            </div>
            <!-- End Firebase Auth Section -->

            <div class="project-controls">
                <button class="btn btn-primary btn-sm w-full" id="new-project-btn">새 프로젝트 생성</button>
                <div class="flex gap-1 mt-2">
                    <button class="btn btn-outline-secondary btn-sm flex-grow" id="import-project-btn">가져오기</button>
                    <input type="file" id="import-file-input" class="hidden" accept=".json,application/json">
                    <button class="btn btn-outline-secondary btn-sm flex-grow" id="export-project-btn">내보내기</button>
                </div>
            </div>
            <!-- Modified project list section for fixed height and scroll -->
            <div class="sidebar-section project-list-section">
                <h6 class="sidebar-title">프로젝트</h6>
                <div id="project-list" class="list-group">
                    <!-- Empty State for Project List -->
                    <div class="empty-state" id="project-list-empty-state">
                        <i class="fa-solid fa-folder-open empty-state-icon"></i>
                        <p class="empty-state-message">생성된 프로젝트가 없습니다.<br>새 프로젝트를 만들어 학습을 시작해보세요!</p>
                        <button class="btn btn-primary btn-sm empty-state-cta" id="empty-state-new-project-btn">새 프로젝트 생성</button>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section flex-grow" style="overflow-y: auto; min-height: 150px;">
                <h6 class="sidebar-title">자원 라이브러리</h6>
                <div id="resource-list" class="list-group">
                    <!-- Empty State for Resource List -->
                    <div class="empty-state" id="resource-list-empty-state">
                        <i class="fa-solid fa-book empty-state-icon"></i>
                        <p class="empty-state-message">추가된 자원이 없습니다.<br>학습 자료를 업로드해보세요!</p>
                    </div>
                </div>
            </div>
            <div class="mt-auto pt-3 grid gap-2">
                <button class="btn btn-success btn-sm" id="download-studypad-btn"><i class="fa-solid fa-book me-2"></i>스터디 패드 전체 다운로드</button>
                <button class="btn btn-secondary btn-sm" id="manage-actions-btn">액션 관리자</button>
                <button class="btn btn-success btn-sm" id="add-resource-btn">자원 추가</button>
            </div>
        </aside>

        <main class="main-content">
             <header class="mobile-header">
                 <button class="hamburger-btn" id="hamburger-btn" aria-label="메뉴 열기">
                     <i class="fa-solid fa-bars"></i>
                 </button>
                 <h2 class="project-title-mobile" id="project-title-mobile">ILE v8.5</h2>
             </header>
             <div class="main-content-inner">
                 <div id="welcome-screen">
                     <div class="text-center p-8 md:p-12 rounded-xl bg-secondary-gray-100 shadow-md">
                        <h1 class="text-5xl font-bold text-primary-blue-darkest mb-4">학습 사령부</h1>
                        <p class="text-secondary-gray-600 text-lg">왼쪽 메뉴에서 새 프로젝트를 생성하거나 선택하여 시작하세요.</p>
                        <img src="https://placehold.co/400x250/E9EDF2/6B7280?text=Welcome+Illustration" alt="환영 일러스트" class="mx-auto mt-8 rounded-lg">
                     </div>
                 </div>
                 <div id="project-workspace" class="hidden">
                     <div class="main-header mb-8 pb-4 border-b border-secondary-gray-300">
                        <h1 id="project-title-main" class="mb-2"></h1>
                        <p id="project-goal"></p>
                     </div>
                     <div class="mb-6 p-6 rounded-xl bg-secondary-gray-100 border border-secondary-gray-300 shadow-sm">
                         <h5 class="text-2xl font-semibold mb-4 text-primary-blue-darkest">Phase 0: 계획 수립</h5>
                         <!-- Added an ID for direct access to the button -->
                         <button class="btn btn-outline-primary w-full mb-4" id="plan-button" data-template-key="0_plan"><i class="fa-solid fa-map-location-dot me-2"></i>AI 튜터 페르소나 설계 및 학습 계획 생성</button>
                         <textarea class="form-control text-base" id="plan-input" rows="8" placeholder="AI가 생성한 학습 계획 JSON을 여기에 붙여넣으세요..."></textarea>
                         <button class="btn btn-info btn-sm w-full mt-4" id="apply-plan-btn">학습 계획 적용 및 워크스페이스 구축</button>
                     </div>
                     <hr class="my-6 border-secondary-gray-300">

                     <!-- New Learning Progress Section -->
                     <div class="mb-6 p-6 rounded-xl bg-secondary-gray-100 border border-secondary-gray-300 shadow-sm">
                         <h5 class="text-2xl font-semibold mb-4 text-primary-blue-darkest">학습 진행도 분석</h5>
                         <div class="mb-4">
                             <label class="form-label text-sm text-secondary-gray-600">전체 진행률</label>
                             <div class="progress h-6 rounded-md bg-secondary-gray-200">
                                 <div class="progress-bar rounded-md" role="progressbar" id="overall-progress-bar" style="width: 0%; background-color: var(--accent-primary);" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                             </div>
                         </div>
                         <div class="grid grid-cols-3 text-center mt-4 text-sm gap-4">
                             <div class="flex flex-col items-center">
                                 <p class="mb-1 text-semantic-success"><i class="fa-solid fa-check-circle me-1"></i> 완료</p>
                                 <h6 class="text-semantic-success text-3xl font-bold" id="completed-modules-count">0</h6>
                             </div>
                             <div class="flex flex-col items-center">
                                 <p class="mb-1 text-semantic-warning"><i class="fa-solid fa-hourglass-half me-1"></i> 진행 중</p>
                                 <h6 class="text-semantic-warning text-3xl font-bold" id="inprogress-modules-count">0</h6>
                             </div>
                             <div class="flex flex-col items-center">
                                 <p class="mb-1 text-secondary-gray-600"><i class="fa-solid fa-clock me-1"></i> 대기</p>
                                 <h6 class="text-secondary-gray-600 text-3xl font-bold" id="pending-modules-count">0</h6>
                             </div>
                         </div>
                         <div class="mt-6">
                             <canvas id="module-status-chart" width="400" height="200"></canvas>
                         </div>
                     </div>
                     <hr class="my-6 border-secondary-gray-300">

                     <h5 class="text-2xl font-semibold mb-4 text-primary-blue-darkest">Phase 1 & 2: 학습 및 실행 대시보드</h5>
                     <div class="module-grid" id="learning-dashboard">
                         <!-- Empty State for Learning Dashboard -->
                         <div class="col-span-full empty-state" id="learning-dashboard-empty-state">
                             <i class="fa-solid fa-clipboard-list empty-state-icon"></i>
                             <p class="empty-state-message">아직 학습 모듈이 없습니다.<br>'계획 수립' 섹션에서 학습 계획을 적용해주세요!</p>
                         </div>
                     </div>
                 </div>
             </div>
        </main>
    </div>
    
    <div class="overlay" id="overlay"></div>
    
    <!-- New Confirmation Modal -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content rounded-xl border border-secondary-gray-300 shadow-lg">
                <div class="modal-header border-b border-secondary-gray-300">
                    <h5 class="modal-title text-xl font-semibold text-primary-blue-darkest" id="confirmationModalLabel">확인</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-secondary-gray-800 py-6">
                    <p id="confirmationModalMessage" class="text-base"></p>
                </div>
                <div class="modal-footer border-t border-secondary-gray-300">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" id="confirm-cancel-btn">취소</button>
                    <button type="button" class="btn btn-danger" id="confirm-ok-btn">확인</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="newProjectModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">새 프로젝트 생성</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form id="new-project-form"><div class="mb-3"><label for="new-project-name" class="form-label">프로젝트 이름</label><input type="text" id="new-project-name" class="form-control rounded-lg" required></div><div class="mb-3"><label for="new-project-goal" class="form-label">최종 학습 목표</label><textarea id="new-project-goal" class="form-control rounded-lg" rows="3" required></textarea></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button><button type="button" class="btn btn-primary" id="save-project-btn">생성</button></div></div></div></div>
    <div class="modal fade" id="resourceModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="resourceModalTitle">자원 관리</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><input type="hidden" id="resource-id"><div class="mb-3"><label for="resource-name" class="form-label">자원 이름</label><input type="text" id="resource-name" class="form-control rounded-lg" placeholder="예: 1장 - 뉴턴 역학"></div><div class="mb-3"><label for="resource-content" class="form-label">내용</label><textarea id="resource-content" class="form-control rounded-lg" rows="10"></textarea></div><label for="resource-file-input" class="form-label">파일에서 불러오기</label><input type="file" id="resource-file-input" class="form-control rounded-lg" accept=".txt,.md,.pdf,.json"></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button><button type="button" class="btn btn-primary" id="save-resource-btn">저장</button></div></div></div></div>
    <div class="modal fade" id="promptModal" tabindex="-1"><div class="modal-dialog modal-xl"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="promptModalLabel"></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="col-span-1"><div id="dynamic-form-container" class="mb-4"></div><div id="data-source-container" class="mb-4"><label class="form-label">데이터 소스</label><div class="flex flex-wrap gap-2"><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="dataSource" id="source-none" value="none" checked><label class="form-check-label" for="source-none">없음</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="dataSource" id="source-resource" value="resource"><label class="form-check-label" for="source-resource">자원</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="dataSource" id="source-studypad" value="studypad"><label class="form-check-label" for="source-studypad">스터디 패드</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="dataSource" id="source-direct" value="direct"><label class="form-check-label" for="source-direct">직접 입력</label></div></div></div><div id="data-selector-container" class="mb-4 hidden"><label for="data-selector" class="form-label">자원 선택</label><select id="data-selector" class="form-select rounded-lg"></select></div><div id="data-direct-input-container" class="mb-4 hidden"><label for="data-direct-input" class="form-label">데이터 직접 입력</label><textarea id="data-direct-input" rows="5" class="form-control rounded-lg"></textarea></div></div><div class="col-span-1"><h6><i class="fa-solid fa-display me-2"></i>실시간 최종 프롬프트 미리보기</h6><div id="live-preview-container" class="rounded-lg"></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button><button type="button" class="btn btn-primary" id="execute-prompt-btn"><i class="fa-solid fa-copy me-2"></i>프롬프트 복사</button></div></div></div></div>
    <div class="modal fade" id="actionManagerModal" tabindex="-1"><div class="modal-dialog modal-xl modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">액션 관리자</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div id="action-list-container"></div></div><div class="modal-footer"><button type="button" class="btn btn-success" id="add-new-action-btn">새 액션 추가</button><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button></div></div></div></div>
    <div class="modal fade" id="actionEditorModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="actionEditorTitle"></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form id="action-editor-form"><input type="hidden" id="action-key-input"><div class="mb-3"><label for="action-title-input" class="form-label">액션 제목</label><input type="text" class="form-control rounded-lg" id="action-title-input" required></div><div class="mb-3"><label for="action-category-input" class="form-label">카테고리</label><input type="text" class="form-control rounded-lg" id="action-category-input" placeholder="예: 이해, 연습, 창조" required></div><div class="mb-3"><label for="action-purpose-input" class="form-label">Purpose 템플릿</label><textarea class="form-control rounded-lg" id="action-purpose-input" rows="10" placeholder="[모듈 제목] 등 변수를 사용하세요."></textarea></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button><button type="button" class="btn btn-primary" id="save-action-btn">저장</button></div></div></div></div>
    <div class="modal fade" id="actionSelectorModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">액션 선택</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body" id="action-selector-body"></div></div></div></div>
    
    <!-- New Modal for Study Pad Viewer -->
    <div class="modal fade" id="studyPadViewerModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="studyPadViewerTitle">스터디 패드 내용 보기</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Container for both viewer and editor -->
                    <div id="study-pad-content-wrapper">
                        <div id="study-pad-viewer-content"></div>
                        <textarea id="study-pad-editor-content" class="form-control rounded-lg hidden" rows="20"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="toggle-viewer-mode-btn">편집 모드</button>
                    <button type="button" class="btn btn-primary hidden" id="save-viewer-content-btn">저장</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Modal for Detailed Content View (for learning objectives, etc.) -->
    <div class="modal fade" id="detailViewerModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailViewerTitle">상세 보기</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="detailViewerBody">
                    <!-- Content will be injected here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>


    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1200"><div id="liveToast" class="toast" role="alert"><div class="toast-header"><strong class="me-auto" id="toast-title"></strong><button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button></div><div class="toast-body" id="toast-body"></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.js for data visualization -->
    
    <!-- Firebase SDK Imports -->
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

    <!-- Custom JavaScript Modules -->
    <script type="module" src="./constants.js"></script>
    <script type="module" src="./utils.js"></script>
    <script type="module" src="./auth.js"></script>
    <script type="module" src="./db.js"></script>
    <script type="module" src="./ui.js"></script>
    <script type="module" src="./modals.js"></script>
    <script type="module" src="./promptBuilder.js"></script>
    <script type="module" src="./main.js"></script>
</body>
</html>
